<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Info Scan — v7.4</title>

<style>
  :root{
    --rw-red: #D20014;
    --text: #111827;
    --muted: #6b7280;
    --line: #000;

    --green: #059669;
    --yellow: #CA8A04;
    --red: #B91C1C;
  }

  body{
    margin:0;
    background:var(--rw-red);
    font-family: Arial, monospace;
    color:var(--text);
  }

  /* TOP BAR --------------------------------------------------- */
  .top{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:16px 18px 10px;
    background:var(--rw-red);
    color:#fff;
  }

  .top-title{
    font-size:20px;
    font-weight:700;
    line-height:1;
  }

  .logo{
    height:38px;
    object-fit:contain;
  }

  /* LAYOUT ---------------------------------------------------- */
  .page{
    padding:16px;
  }

  .card{
    background:white;
    border-radius:14px;
    padding:18px;
    margin-bottom:16px;
  }

  /* CAMERA ---------------------------------------------------- */
  #cameraWrap{
    background:#f3f4f6;
    height:260px;
    border-radius:12px;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#9ca3af;
    overflow:hidden;
  }

  #cameraWrap video{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  /* BUTTON ---------------------------------------------------- */
  .btn{
    width:100%;
    height:56px;
    background:#111827;
    color:white;
    font-size:20px;
    font-weight:700;
    border-radius:12px;
    border:none;
    margin-top:16px;
    cursor:pointer;
  }

  /* RAW DATA -------------------------------------------------- */
  .raw-title{
    font-size:22px;
    font-weight:700;
    margin-bottom:12px;
  }

  .cat{
    font-size:20px;
    font-weight:700;
    margin-top:10px;
  }

  .line{
    border-bottom:2px solid #000;
    margin:6px 0 10px;
  }

  .value{
    font-size:18px;
    white-space:pre-line;
  }

  .w-green{ color:var(--green); font-weight:700; }
  .w-yellow{ color:var(--yellow); font-weight:700; }
  .w-red{ color:var(--red); font-weight:700; }

  #hazardIcon{
    width:42px;
    position:absolute;
    right:12px;
    bottom:12px;
    display:none;
  }

  #copyBtn{
    width:100%;
    height:50px;
    margin-top:16px;
    border-radius:12px;
    border:2px solid #ddd;
    background:white;
    font-size:20px;
    font-weight:700;
    cursor:pointer;
  }
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="top">
  <div class="top-title">Info Scan — v7.1.1</div>
  <img src="logo.png" class="logo" alt="ROCKWOOL logo">
</div>

<div class="page">

  <!-- SCANNER -->
  <div class="card">
    <div style="font-weight:700;margin-bottom:8px;">Scanner</div>
    <div id="cameraWrap">Kamera er slukket</div>
    <button class="btn" id="scanBtn">NY SCANNING</button>
  </div>

  <!-- RAW DATA -->
  <div class="card" style="position:relative;">
    <div class="raw-title">Rådata</div>

    <div id="raw"></div>

    <!-- Hazard icon -->
    <svg id="hazardIcon" viewBox="0 0 400 400">
      <polygon points="200,20 380,200 200,380 20,200"
        fill="white" stroke="#d32f2f" stroke-width="35"/>
      <circle cx="200" cy="270" r="35" fill="black"/>
      <rect x="182" y="90" width="36" height="140" rx="18" fill="black"/>
    </svg>

    <button id="copyBtn">KOPIER</button>
  </div>

</div>

<script>

function esc(s){ return s.replace(/[&<>]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m])) }

function classifyWeight(kg){
  if(kg <= 15) return {cls:"w-green", extra:""};
  if(kg <= 30) return {cls:"w-yellow", extra:" (Pas på når du løfter)"};
  return {cls:"w-red", extra:" (Brug hjælpe værktøj til løft)"};
}

function clearRaw(){
  raw.innerHTML="";
  hazardIcon.style.display="none";
  copyBtn.disabled=true;
}

function drawLine(cat, value, cls=""){
  raw.insertAdjacentHTML("beforeend", `
    <div class="cat">${cat}</div>
    <div class="line"></div>
    <div class="value ${cls}">${value}</div>
  `);
}

function parse(rawText){
  clearRaw();

  const lines = rawText.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
  let data = {};
  let andenInfo = [];

  let inAnden = false;

  lines.forEach(line=>{
    if(/^Anden info/i.test(line)){
      inAnden = true;
      const p = line.split(":");
      if(p[1]) andenInfo.push(p[1].trim());
      return;
    }

    if(inAnden){
      if(/^[A-Za-z].*?:/.test(line)){
        inAnden = false;
        // reprocess
        const p=line.split(":");
        data[p[0].trim()] = p.slice(1).join(":").trim();
      } else {
        andenInfo.push(line);
      }
      return;
    }

    const p=line.split(":");
    if(p.length>=2) data[p[0].trim()] = p.slice(1).join(":").trim();
  });

  if(andenInfo.length) data["Anden info"] = andenInfo.join("\n");

  let unFound = false;
  Object.values(data).forEach(v=>{
    if(/\bUN\d+/.test(v)) unFound = true;
  });

  if(unFound) hazardIcon.style.display="block";

  // ORDER — *Plads flyttet ind i Lagerplads gruppen*
  const order = [
    "Område","Varenummer","Materiale","Antal",
    "L","B","T","Vægt","Meter","Areal m²",
    "Anden info",
    "Lager/Område","Reol","Hylde","Plads",
    "Kemi"
  ];

  function renderCategory(cat){
    if(!(cat in data)) return;
    let value = esc(data[cat]);

    if(cat==="Vægt"){
      let kg=parseFloat(value.replace(",","."));
      if(!isNaN(kg)){
        const info=classifyWeight(kg);
        value = `${kg} kg${esc(info.extra)}`;
        drawLine(cat, value, info.cls);
        return;
      }
    }

    drawLine(cat, value);
  }

  // Main fields
  ["Område","Varenummer","Materiale","Antal"].forEach(renderCategory);

  // Mål-gruppen
  let mål = [];
  if("L" in data) mål.push("L: "+esc(data.L));
  if("B" in data) mål.push("B: "+esc(data.B));
  if("T" in data) mål.push("T: "+esc(data.T));
  if(mål.length){
    drawLine("Mål", mål.join("\n"));
  }

  // Vægt
  renderCategory("Vægt");
  // Meter
  renderCategory("Meter");
  // Areal
  renderCategory("Areal m²");
  // Anden info
  if("Anden info" in data){
    drawLine("Anden info", esc(data["Anden info"]));
  }

  // Lagerplads-gruppe — *Plads integreret her*
  let lp = [];
  ["Lager/Område","Reol","Hylde","Plads"].forEach(k=>{
    if(k in data){
      lp.push(`${k}: ${esc(data[k])}`);
    }
  });
  if(lp.length){
    drawLine("Lagerplads", lp.join("\n"));
  }

  // Kemi
  if("Kemi" in data){
    drawLine("Kemi", esc(data["Kemi"]));
  }

  copyBtn.disabled=false;
}

/* Copy */
copyBtn.onclick = ()=>{
  navigator.clipboard.writeText(raw.innerText);
};

/* Scan button → Simulated test for now */
scanBtn.onclick = ()=>{
  clearRaw();

  // Simulated input (kamera virker når du hoster)
  const simulation = `
Område: sm
Varenummer: 5456454
Materiale: Test
Antal: 9 KS på PL
L: 1200 mm
B: 600 mm
T: 50 mm
Vægt: 10
Meter: 12
Areal m²: 7.2
Anden info: rør skåle 28/20
nyt felt
Lager/Område: sym01
Reol: 01
Hylde: 02
Plads: 03
Kemi: UN1209`;

  parse(simulation);
};

</script>
</body>
</html>
