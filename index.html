<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INFO SCAN v8.2</title>

<style>
body{
    margin:0;
    padding:0;
    background:#e6e6e6;
    font-family:Arial,Helvetica,sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    height:100vh;
}

/* —— LAYOUT & DESIGN 100% SOM VERSION 7.9 —— */

#container{
    width:100%;
    max-width:500px;
    padding:20px;
    box-sizing:border-box;
}

/* Kamervinduet — præcis som i v7.9 */
#cameraWrap{
    width:100%;
    aspect-ratio:1/1;
    background:#000;
    border-radius:20px;
    overflow:hidden;
    position:relative;
    margin-bottom:20px;
}

/* Video — præcis som i v7.9 */
#cameraWrap video{
    width:100%;
    height:100%;
    object-fit:cover;
    transform:none !important;
    -webkit-transform:none !important;
}

#resultBox{
    width:100%;
    background:#fff;
    border-radius:15px;
    padding:15px;
    font-size:18px;
    text-align:center;
    box-sizing:border-box;
}
</style>
</head>
<body>

<div id="container">
    <div id="cameraWrap">
        <video id="camera" playsinline></video>
    </div>

    <div id="resultBox">Scan en QR-kode…</div>
</div>

<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>

<script>
let stream = null;
const video = document.getElementById("camera");
const resultBox = document.getElementById("resultBox");

/* ————————————————
   START CAMERA (FLEKSIBEL)
   ———————————————— */
async function startCamera(){
    if(stream){
        stream.getTracks().forEach(t => t.stop());
        stream = null;
    }

    try{
        stream = await navigator.mediaDevices.getUserMedia({
            video:{
                facingMode:{ ideal:"environment" },
                width:{ min:640, ideal:1280, max:1920 },
                height:{ min:480, ideal:720, max:1080 },
                focusMode:"continuous"
            },
            audio:false
        });

        video.srcObject = stream;
        video.play();

    }catch(err){
        resultBox.textContent = "Kamera-fejl: " + err;
    }
}

/* ————————————————
   SCANNER MED RÅ STREAM
   (LØSER ANDROID + iPHONE)
   ———————————————— */
function scanLoop(){
    if(video.readyState === video.HAVE_ENOUGH_DATA){

        const track = stream.getVideoTracks()[0];
        const cap = track.getSettings();

        const w = cap.width;
        const h = cap.height;

        const canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, w, h);

        const img = ctx.getImageData(0, 0, w, h);
        const code = jsQR(img.data, w, h);

        if(code){
            resultBox.textContent = code.data;
        }
    }

    requestAnimationFrame(scanLoop);
}

/* Start */
startCamera();
requestAnimationFrame(scanLoop);
</script>

</body>
</html>
