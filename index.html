<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Info Scan — v6.6</title>

<style>
  :root{
    --rw-red: #D20014;
    --bg: #D20014;
    --text: #111;
    --line: #000;
    --green: #059669;
    --yellow: #CA8A04;
    --red: #B91C1C;
  }

  body{
    margin:0;
    background:var(--bg);
    font-family: Arial, sans-serif;
  }

  /* --- HEADER --- */
  .header{
    padding:18px 20px;
    background:var(--rw-red);
    color:white;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  .header .title{
    font-size:24px;
    font-weight:700;
    line-height:1.1;
  }

  .header img{
    height:38px;
  }

  /* --- MAIN AREA --- */
  .page{
    padding:20px;
  }

  .card{
    background:white;
    border-radius:16px;
    padding:20px;
    margin-bottom:22px;
  }

  /* CAMERA BOX */
  #cameraWrap{
    background:#f3f4f6;
    border-radius:12px;
    height:260px;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#9ca3af;
    overflow:hidden;
  }
  #cameraWrap video{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  /* BUTTON */
  .btn{
    width:100%;
    margin-top:20px;
    padding:20px 0;
    font-size:22px;
    font-weight:700;
    color:white;
    background:#0D1117;
    border:none;
    border-radius:12px;
  }

  /* RÅDATA */
  .raw-title{
    font-size:22px;
    font-weight:700;
    margin-bottom:12px;
  }

  .raw-line{
    padding:10px 0;
    font-size:20px;
    border-bottom:2px solid var(--line);
    white-space:pre-wrap;
  }

  /* CATEGORY HEADERS */
  .cat{
    font-size:22px;
    font-weight:700;
    margin-top:18px;
  }

  /* WEIGHT COLORS */
  .w-green{ color:var(--green); font-weight:700; }
  .w-yellow{ color:var(--yellow); font-weight:700; }
  .w-red{ color:var(--red); font-weight:700; }

  /* HAZARD ICON */
  #hazardIcon{
    width:48px;
    position:absolute;
    right:18px;
    bottom:18px;
    display:none;
  }
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <div class="title">Info Scan —<br>v6.6</div>
  <img src="rockwool-logo.png" alt="ROCKWOOL">
</div>

<div class="page">

  <!-- SCANNER -->
  <div class="card">
    <div id="cameraWrap">Kamera er slukket</div>
    <button id="scanBtn" class="btn">NY SCANNING</button>
  </div>

  <!-- RÅDATA -->
  <div class="card" style="position:relative;">
    <div class="raw-title">Rådata</div>
    <div id="raw"></div>
    <img id="hazardIcon" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA0MDAgNDAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwb2x5Z29uIHBvaW50cz0iMjAwLDIwIDM4MCwyMDAgMjAwLDM4MCAyMCwyMDAiIGZpbGw9IndoaXRlIiBzdHJva2U9IiNkMzJmMmYiIHN0cm9rZS13aWR0aD0iMzUiLz48Y2lyY2xlIGN4PSIyMDAiIGN5PSIyNzAiIHI9IjM1IiBmaWxsPSJibGFjayIvPjxyZWN0IHg9IjE4MiIgeT0iOTAiIHdpZHRoPSIzNiIgaGVpZ2h0PSIxNDAiIHJ4PSIxOCIgc3R5bGU9ImZpbGw6YmxhY2siLz48L3N2Zz4="/>
  </div>

</div>

<script>
const scanBtn = document.getElementById("scanBtn");
const rawBox = document.getElementById("raw");
const hazardIcon = document.getElementById("hazardIcon");
let video, stream, canvas, ctx;

/* Helpers */
function escape(s){ return s.replace(/[&<>]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m])) }
function weightClass(v){
  if(v <= 15) return ["w-green",""];
  if(v <= 30) return ["w-yellow"," (Pas på når du løfter)"];
  return ["w-red"," (Brug hjælpe værktøj til løft)"];
}

/* Clear data */
function clearRaw(){
  rawBox.innerHTML="";
  hazardIcon.style.display="none";
}

/* Draw lines */
function addLine(text, cls=""){
  const div=document.createElement("div");
  div.className="raw-line "+cls;
  div.innerHTML=text;
  rawBox.appendChild(div);
}

/* Parse QR */
function showRaw(data){
  clearRaw();
  const lines = data.trim().split(/\r?\n/);

  let insideInfo = false;

  lines.forEach(line=>{
    const clean = escape(line);

    // Hazard detection
    if(/UN\d+/.test(line)) hazardIcon.style.display="block";

    // Weight detection
    if(/^Vægt:/i.test(line)){
      const kg = parseFloat(line.replace(",",".").match(/([\d\.]+)/));
      const [cls, extra] = weightClass(kg);
      addLine(`Vægt: ${kg} kg${extra}`, cls);
      return;
    }

    addLine(clean);
  });
}

/* Start scanning */
async function startScan(){
  clearRaw();
  scanBtn.textContent = "SCANNER…";

  if(!video){
    video=document.createElement("video");
    video.setAttribute("playsinline",true);
  }
  if(!canvas){
    canvas=document.createElement("canvas");
    ctx=canvas.getContext("2d");
  }

  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
    video.srcObject = stream;
    await video.play();
    document.getElementById("cameraWrap").innerHTML="";
    document.getElementById("cameraWrap").appendChild(video);
  }catch(e){
    addLine("DEMO DATA:");
    showRaw("Vægt: 20 kg\nKemi: UN1209");
    scanBtn.textContent="NY SCANNING";
    return;
  }

  requestAnimationFrame(loop);
}

/* Loop */
async function loop(){
  if(video.readyState < 2){ requestAnimationFrame(loop); return; }

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video,0,0);

  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  if(window.jsQR){
    const code = jsQR(img.data, img.width, img.height);
    if(code){
      stopScan();
      showRaw(code.data);
      scanBtn.textContent="NY SCANNING";
      return;
    }
  }
  requestAnimationFrame(loop);
}

function stopScan(){
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
  }
}

scanBtn.addEventListener("click", startScan);

/* Load jsQR */
const s=document.createElement("script");
s.src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js";
document.head.appendChild(s);
</script>

</body>
</html>
